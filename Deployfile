#!/usr/bin/env groovy

podTemplate(label: 'mypod', containers: [
    containerTemplate(name: 'helm', image: 'lachlanevenson/k8s-helm:latest', command: 'cat', ttyEnabled: true)
  ],
  envVars: [
    envVar(key: 'v1_release', value: ${env.v1_release})
  ],
  volumes: [
    hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
  ]) {

    node('mypod') {

        checkout scm

        echo "${env.v1_release}"
        echo ""
        echo ""

                // print environment variables
                echo sh(script: 'env|sort', returnStdout: true)

        stage('do some helm work') {
            container('helm') {

                dir("charts") {

                    sh "helm ls"

                    sh "helm lint smackapi"
                    //sh "helm upgrade -i smackapi --set image.tag=${imageTag} smackapi"
                }
            }
        }
    }
}